## 基础架构

网络库 + 消息队列 + 数据持久化 + Zookeeper

### 消息队列

- 生产者生产消息 

- 消费者消费信息（消费信息后不会被删除，后期可提供日志监测功能）

- 消息队列持久化

- 分片管理消息队列，支持分布式

- 通过Zookeeper管理分片

- 由 Producer 向 broker push 消息并由 Consumer 从 broker pull 消息。

#### Broker
单个消息队列服务器，支持水平扩展。

#### Topic
每个broker拥有多个topic，topic是一个queue, topic是不同消息分类，即不同消费者所关心的事件。

#### Partition（高并发）
为了提高吞吐率，将topic分成一个或多个Partition，类似于kv存储中按k进行分片管理，将不同分片放到不同集群。由于分到不同集群则消费者需要知道想要的信息在那个集群中则可以考虑Zookeeper来做一个服务注册和发现。

#### 高可用
为了提高系统的高可用性，需要对数据进行备份处理，通过将一份数据备份到多台机器，构成一个集群，这样其中一个broker故障后集群中的其他broker可以立即替代。（可以采用824中raft和shardkv部分，对其进行部分修改，例如RPC需要重新注册，不再是kv处理等）
### 网络库
通过网络库进行进程间通讯（可以考虑使用RPC），后期争取将自己的网络库可以支持ymq。

#### RPC
由于RPC只支持单向调用，导致mq只支持push（生产者将消息发送至broker）和pull(消费者主动从broker拉取消息)，想要支持broker主动将信息交给消费者，则需要双向的RPC服务。需要在client也注册服务。

## 数据持久化
每个Partition创建一个文件，采取顺序读写的方式提高性能。
